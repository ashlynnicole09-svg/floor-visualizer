<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Floor Visualizer — v4 Full Diagnostics</title>
  <meta name="description" content="Diagnostics build with event overlay and debug log export." />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <h1>Floor Visualizer <span class="badge">v4-full</span></h1>
    <div class="actions">
      <button id="btnLoadDemo" class="secondary">Load Demo Room</button>
      <button id="btnExportImage" disabled>Export PNG</button>
      <button id="btnSaveConfig" class="secondary" disabled>Save Session</button>
      <input type="file" id="btnLoadConfig" accept="application/json" class="hidden"/>
      <button id="btnLoadConfigProxy" class="secondary" disabled>Load Session</button>
      <button id="btnCopyDebug" class="secondary">Copy Debug</button>
      <button id="btnDownloadDebug" class="secondary">Download Debug</button>
    </div>
  </header>

  <main class="app-main">
    <aside class="left">
      <section class="card">
        <h2>1) Room Photo</h2>
        <input type="file" id="roomInput" accept="image/*" />
        <p class="muted">Drag & drop onto the stage also works.</p>
        <div class="tool-row">
          <button id="btnFit">Fit</button>
          <button id="btn1x">1:1</button>
          <button id="btnAutoFloor" class="secondary" disabled>Auto floor</button>
          <label><input type="checkbox" id="chkGuides" checked/> Show Guides</label>
        </div>
        <div class="tool-row">
          <button id="btnResetPoints" class="danger" disabled>Reset Floor Points</button>
          <button id="btnMeasure" class="secondary" disabled>Measure Tool</button>
        </div>
        <div class="tool-row">
          <label>Known Distance: <input type="number" id="knownDistance" min="1" step="0.1" value="36"/> in</label>
          <button id="btnSetScale" class="secondary" disabled>Set Scale from Line</button>
          <span id="ppiOut" class="muted">PPI: —</span>
        </div>
      </section>

      <section class="card">
        <h2>2) Flooring Texture</h2>
        <div class="texture-grid" id="textureGrid"></div>
        <div class="upload-row">
          <input type="file" id="texInput" accept="image/*" />
        </div>
      </section>

      <section class="card">
        <h2>3) Layout & Scale</h2>
        <div class="grid-2">
          <label>Plank Length (in)<input type="number" id="plankLen" min="1" step="0.25" value="48"/></label>
          <label>Plank Width (in)<input type="number" id="plankWid" min="1" step="0.25" value="7"/></label>
        </div>
        <label>Angle (°)<input type="range" id="angle" min="0" max="180" value="0"/></label>
        <label>Opacity<input type="range" id="opacity" min="20" max="100" value="90"/></label>
        <label>Exposure<input type="range" id="exposure" min="80" max="120" value="100"/></label>
        <label>Contrast<input type="range" id="contrast" min="80" max="120" value="100"/></label>
      </section>
    </aside>

    <section class="stage-wrap">
      <div id="stage" class="dropzone">
        <img id="roomImg" alt="Room" />
        <canvas id="glCanvas"></canvas>
        <svg id="overlay" xmlns="http://www.w3.org/2000/svg">
          <polygon id="floorPoly" points="" />
          <g id="handles"></g>
          <line id="measureLine" x1="0" y1="0" x2="0" y2="0" class="hidden" />
        </svg>

        <!-- Event trace HUD -->
        <div id="hud">
          <div><strong>HUD:</strong> click/touch shows dots; green = add point, yellow = drag, pink = measure</div>
        </div>
      </div>
      <p class="muted smallpad">Click four corners of the floor (clockwise). Drag handles to adjust. Use measure to set scale.</p>
      <details class="card">
        <summary>Debug</summary>
        <div id="debugPanel">
          <div><strong>Status:</strong> <span id="status">init</span></div>
          <div><strong>Room loaded:</strong> <span id="roomLoadedTxt">false</span></div>
          <div><strong>GL:</strong> <span id="glTxt">not-initialized</span></div>
          <div><strong>Points:</strong> <span id="pointsTxt">0</span></div>
          <div><strong>Canvas:</strong> <span id="canvasTxt">0×0</span></div>
          <div><strong>Img:</strong> <span id="imgTxt">0×0</span></div>
          <div><strong>Last event:</strong> <span id="lastEvtTxt">—</span></div>
          <pre id="log" class="log"></pre>
        </div>
      </details>
    </section>

    <aside class="right">
      <section class="card">
        <h2>Help</h2>
        <ol class="steps">
          <li>Upload or drag in a room photo.</li>
          <li>Wait for "Room loaded: true".</li>
          <li>Click 4 floor corners (clockwise), or press Auto floor.</li>
          <li>Select a texture and adjust.</li>
        </ol>
      </section>
    </aside>
  </main>

  <footer class="app-footer">
    <span>© <span id="year"></span> Floor Visualizer — v4-full diagnostics.</span>
  </footer>

  <script src="app.js"></script>
</body>
</html>
